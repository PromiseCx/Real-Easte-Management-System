{"remainingRequest":"D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\src\\views\\other\\modules\\RoleModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\src\\views\\other\\modules\\RoleModal.vue","mtime":1587193627716},{"path":"D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WebStrom\\TestProject\\project\\06楼盘管理3\\webproject\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBnZXRQZXJtaXNzaW9ucyB9IGZyb20gJ0AvYXBpL21hbmFnZScNCmltcG9ydCB7IGFjdGlvblRvT2JqZWN0IH0gZnJvbSAnQC91dGlscy9wZXJtaXNzaW9ucycNCmltcG9ydCBwaWNrIGZyb20gJ2xvZGFzaC5waWNrJw0KDQpleHBvcnQgZGVmYXVsdCB7DQogICAgbmFtZTogJ1JvbGVNb2RhbCcsDQogICAgZGF0YSgpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGxhYmVsQ29sOiB7DQogICAgICAgICAgICAgICAgeHM6IHsgc3BhbjogMjQgfSwNCiAgICAgICAgICAgICAgICBzbTogeyBzcGFuOiA1IH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB3cmFwcGVyQ29sOiB7DQogICAgICAgICAgICAgICAgeHM6IHsgc3BhbjogMjQgfSwNCiAgICAgICAgICAgICAgICBzbTogeyBzcGFuOiAxNiB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdmlzaWJsZTogZmFsc2UsDQogICAgICAgICAgICBjb25maXJtTG9hZGluZzogZmFsc2UsDQogICAgICAgICAgICBtZGw6IHt9LA0KDQogICAgICAgICAgICBmb3JtOiB0aGlzLiRmb3JtLmNyZWF0ZUZvcm0odGhpcyksDQogICAgICAgICAgICBwZXJtaXNzaW9uczogW10NCiAgICAgICAgfQ0KICAgIH0sDQogICAgY3JlYXRlZCgpIHsNCiAgICAgICAgdGhpcy5sb2FkUGVybWlzc2lvbnMoKQ0KICAgIH0sDQogICAgbWV0aG9kczogew0KICAgICAgICBhZGQoKSB7DQogICAgICAgICAgICB0aGlzLmVkaXQoeyBpZDogMCB9KQ0KICAgICAgICB9LA0KICAgICAgICBlZGl0KHJlY29yZCkgew0KICAgICAgICAgICAgdGhpcy5tZGwgPSBPYmplY3QuYXNzaWduKHt9LCByZWNvcmQpDQogICAgICAgICAgICB0aGlzLnZpc2libGUgPSB0cnVlDQoNCiAgICAgICAgICAgIC8vIOacieadg+mZkOihqO+8jOWkhOeQhuWLvumAiQ0KICAgICAgICAgICAgaWYgKHRoaXMubWRsLnBlcm1pc3Npb25zICYmIHRoaXMucGVybWlzc2lvbnMpIHsNCiAgICAgICAgICAgICAgICAvLyDlhYjlpITnkIbopoHli77pgInnmoTmnYPpmZDnu5PmnoQNCiAgICAgICAgICAgICAgICBjb25zdCBwZXJtaXNzaW9uc0FjdGlvbiA9IHt9DQogICAgICAgICAgICAgICAgdGhpcy5tZGwucGVybWlzc2lvbnMuZm9yRWFjaChwZXJtaXNzaW9uID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnNBY3Rpb25bcGVybWlzc2lvbi5wZXJtaXNzaW9uSWRdID0gcGVybWlzc2lvbi5hY3Rpb25FbnRpdHlTZXQubWFwKGVudGl0eSA9PiBlbnRpdHkuYWN0aW9uKQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLy8g5oqK5p2D6ZmQ6KGo6YGN5Y6G5LiA6YGN77yM6K6+5a6a6KaB5Yu+6YCJ55qE5p2D6ZmQIGFjdGlvbg0KICAgICAgICAgICAgICAgIHRoaXMucGVybWlzc2lvbnMuZm9yRWFjaChwZXJtaXNzaW9uID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbi5zZWxlY3RlZCA9IHBlcm1pc3Npb25zQWN0aW9uW3Blcm1pc3Npb24uaWRdIHx8IFtdDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5zZXRGaWVsZHNWYWx1ZShwaWNrKHRoaXMubWRsLCAnaWQnLCAnbmFtZScsICdzdGF0dXMnLCAnZGVzY3JpYmUnKSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICBjb25zb2xlLmxvZygndGhpcy5tZGwnLCB0aGlzLm1kbCkNCiAgICAgICAgfSwNCiAgICAgICAgY2xvc2UoKSB7DQogICAgICAgICAgICB0aGlzLiRlbWl0KCdjbG9zZScpDQogICAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZQ0KICAgICAgICB9LA0KICAgICAgICBoYW5kbGVPaygpIHsNCiAgICAgICAgICAgIGNvbnN0IF90aGlzID0gdGhpcw0KICAgICAgICAgICAgLy8g6Kem5Y+R6KGo5Y2V6aqM6K+BDQogICAgICAgICAgICB0aGlzLmZvcm0udmFsaWRhdGVGaWVsZHMoKGVyciwgdmFsdWVzKSA9PiB7DQogICAgICAgICAgICAgICAgLy8g6aqM6K+B6KGo5Y2V5rKh6ZSZ6K+vDQogICAgICAgICAgICAgICAgaWYgKCFlcnIpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Zvcm0gdmFsdWVzJywgdmFsdWVzKQ0KDQogICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpcm1Mb2FkaW5nID0gdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAvLyDmqKHmi5/lkI7nq6/or7fmsYIgMjAwMCDmr6vnp5Llu7bov58NCiAgICAgICAgICAgICAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUoKSwgMjAwMCkNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBzb21ldGhpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfkv53lrZjmiJDlip8nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLiRlbWl0KCdvaycpDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBEbyBzb21ldGhpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29uZmlybUxvYWRpbmcgPSBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSwNCiAgICAgICAgaGFuZGxlQ2FuY2VsKCkgew0KICAgICAgICAgICAgdGhpcy5jbG9zZSgpDQogICAgICAgIH0sDQogICAgICAgIG9uQ2hhbmdlQ2hlY2socGVybWlzc2lvbikgew0KICAgICAgICAgICAgcGVybWlzc2lvbi5pbmRldGVybWluYXRlID0NCiAgICAgICAgICAgICAgICAhIXBlcm1pc3Npb24uc2VsZWN0ZWQubGVuZ3RoICYmIHBlcm1pc3Npb24uc2VsZWN0ZWQubGVuZ3RoIDwgcGVybWlzc2lvbi5hY3Rpb25zT3B0aW9ucy5sZW5ndGgNCiAgICAgICAgICAgIHBlcm1pc3Npb24uY2hlY2tlZEFsbCA9IHBlcm1pc3Npb24uc2VsZWN0ZWQubGVuZ3RoID09PSBwZXJtaXNzaW9uLmFjdGlvbnNPcHRpb25zLmxlbmd0aA0KICAgICAgICB9LA0KICAgICAgICBvbkNoYW5nZUNoZWNrQWxsKGUsIHBlcm1pc3Npb24pIHsNCiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocGVybWlzc2lvbiwgew0KICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBlLnRhcmdldC5jaGVja2VkID8gcGVybWlzc2lvbi5hY3Rpb25zT3B0aW9ucy5tYXAob2JqID0+IG9iai52YWx1ZSkgOiBbXSwNCiAgICAgICAgICAgICAgICBpbmRldGVybWluYXRlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICBjaGVja2VkQWxsOiBlLnRhcmdldC5jaGVja2VkDQogICAgICAgICAgICB9KQ0KICAgICAgICB9LA0KICAgICAgICBsb2FkUGVybWlzc2lvbnMoKSB7DQogICAgICAgICAgICBjb25zdCB0aGF0ID0gdGhpcw0KICAgICAgICAgICAgZ2V0UGVybWlzc2lvbnMoKS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVzLnJlc3VsdA0KICAgICAgICAgICAgICAgIHRoYXQucGVybWlzc2lvbnMgPSByZXN1bHQubWFwKHBlcm1pc3Npb24gPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gYWN0aW9uVG9PYmplY3QocGVybWlzc2lvbi5hY3Rpb25EYXRhKQ0KICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uLmNoZWNrZWRBbGwgPSBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uLnNlbGVjdGVkID0gW10NCiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbi5pbmRldGVybWluYXRlID0gZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbi5hY3Rpb25zT3B0aW9ucyA9IG9wdGlvbnMubWFwKG9wdGlvbiA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBvcHRpb24uZGVzY3JpYmUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9wdGlvbi5hY3Rpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlcm1pc3Npb24NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgIH0NCn0NCg=="},{"version":3,"sources":["RoleModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RoleModal.vue","sourceRoot":"src/views/other/modules","sourcesContent":["<template>\r\n  <a-modal\r\n    title=\"操作\"\r\n    :width=\"800\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    @ok=\"handleOk\"\r\n    @cancel=\"handleCancel\"\r\n  >\r\n    <a-steps :current=\"1\">\r\n      <a-step>\r\n        <!-- <span slot=\"title\">Finished</span> -->\r\n        <template slot=\"title\">Finished</template>\r\n        <span slot=\"description\">This is a description.</span>\r\n      </a-step>\r\n      <a-step title=\"In Progress\" description=\"This is a description.\" />\r\n      <a-step title=\"Waiting\" description=\"This is a description.\" />\r\n    </a-steps>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\nimport { getPermissions } from '@/api/manage'\r\nimport { actionToObject } from '@/utils/permissions'\r\nimport pick from 'lodash.pick'\r\n\r\nexport default {\r\n    name: 'RoleModal',\r\n    data() {\r\n        return {\r\n            labelCol: {\r\n                xs: { span: 24 },\r\n                sm: { span: 5 }\r\n            },\r\n            wrapperCol: {\r\n                xs: { span: 24 },\r\n                sm: { span: 16 }\r\n            },\r\n            visible: false,\r\n            confirmLoading: false,\r\n            mdl: {},\r\n\r\n            form: this.$form.createForm(this),\r\n            permissions: []\r\n        }\r\n    },\r\n    created() {\r\n        this.loadPermissions()\r\n    },\r\n    methods: {\r\n        add() {\r\n            this.edit({ id: 0 })\r\n        },\r\n        edit(record) {\r\n            this.mdl = Object.assign({}, record)\r\n            this.visible = true\r\n\r\n            // 有权限表，处理勾选\r\n            if (this.mdl.permissions && this.permissions) {\r\n                // 先处理要勾选的权限结构\r\n                const permissionsAction = {}\r\n                this.mdl.permissions.forEach(permission => {\r\n                    permissionsAction[permission.permissionId] = permission.actionEntitySet.map(entity => entity.action)\r\n                })\r\n                // 把权限表遍历一遍，设定要勾选的权限 action\r\n                this.permissions.forEach(permission => {\r\n                    permission.selected = permissionsAction[permission.id] || []\r\n                })\r\n            }\r\n\r\n            this.$nextTick(() => {\r\n                this.form.setFieldsValue(pick(this.mdl, 'id', 'name', 'status', 'describe'))\r\n            })\r\n            console.log('this.mdl', this.mdl)\r\n        },\r\n        close() {\r\n            this.$emit('close')\r\n            this.visible = false\r\n        },\r\n        handleOk() {\r\n            const _this = this\r\n            // 触发表单验证\r\n            this.form.validateFields((err, values) => {\r\n                // 验证表单没错误\r\n                if (!err) {\r\n                    console.log('form values', values)\r\n\r\n                    _this.confirmLoading = true\r\n                    // 模拟后端请求 2000 毫秒延迟\r\n                    new Promise(resolve => {\r\n                        setTimeout(() => resolve(), 2000)\r\n                    })\r\n                        .then(() => {\r\n                            // Do something\r\n                            _this.$message.success('保存成功')\r\n                            _this.$emit('ok')\r\n                        })\r\n                        .catch(() => {\r\n                            // Do something\r\n                        })\r\n                        .finally(() => {\r\n                            _this.confirmLoading = false\r\n                            _this.close()\r\n                        })\r\n                }\r\n            })\r\n        },\r\n        handleCancel() {\r\n            this.close()\r\n        },\r\n        onChangeCheck(permission) {\r\n            permission.indeterminate =\r\n                !!permission.selected.length && permission.selected.length < permission.actionsOptions.length\r\n            permission.checkedAll = permission.selected.length === permission.actionsOptions.length\r\n        },\r\n        onChangeCheckAll(e, permission) {\r\n            Object.assign(permission, {\r\n                selected: e.target.checked ? permission.actionsOptions.map(obj => obj.value) : [],\r\n                indeterminate: false,\r\n                checkedAll: e.target.checked\r\n            })\r\n        },\r\n        loadPermissions() {\r\n            const that = this\r\n            getPermissions().then(res => {\r\n                const result = res.result\r\n                that.permissions = result.map(permission => {\r\n                    const options = actionToObject(permission.actionData)\r\n                    permission.checkedAll = false\r\n                    permission.selected = []\r\n                    permission.indeterminate = false\r\n                    permission.actionsOptions = options.map(option => {\r\n                        return {\r\n                            label: option.describe,\r\n                            value: option.action\r\n                        }\r\n                    })\r\n                    return permission\r\n                })\r\n            })\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"]}]}